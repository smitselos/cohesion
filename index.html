<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Συνοχή & Συνεκτικότητα</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #eef2ff, #f8fafc);
  color: #1e293b;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  margin-bottom: 20px;
}

h1, h2 {
  margin-top: 0;
}

button {
  border: none;
  border-radius: 12px;
  padding: 12px 18px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  margin: 6px;
}

.btn-primary {
  background: #4f46e5;
  color: white;
}

.btn-secondary {
  background: #e0e7ff;
  color: #1e293b;
}

.btn-danger {
  background: #fee2e2;
  color: #991b1b;
}

.word {
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 6px;
}

.word.correct {
  background: #bbf7d0;
}

.word.wrong {
  background: #fecaca;
}

.top-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
</head>

<body>
<div class="container" id="app">
  <div class="card">
    <h1>Συνοχή & Συνεκτικότητα</h1>
    <p>Φόρτωση δεδομένων…</p>
  </div>
</div>

<script>
/* =======================
   ΡΥΘΜΙΣΕΙΣ
======================= */

const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSBmZdhLakrSUcbxWqSdNo5O07jxI7YRJ_J890qyb-u0qqoOqe1RMl18UQx0SFbLBo2Ihdm6gOOnelY/pub?output=csv';


let allData = [];
let sessionData = [];
let currentIndex = 0;
let currentLevel = null;
let questionLimit = 1;

/* =======================
   CSV LOADING
======================= */

async function loadCSV() {
  const res = await fetch(CSV_URL);
  const text = await res.text();
  const lines = text.trim().split('\n');
  const headers = lines[0].split(',').map(h => h.trim());

  allData = lines.slice(1).map(line => {
    const values = line.split(',');
    const obj = {};
    headers.forEach((h, i) => obj[h] = values[i] || '');
    return obj;
  });

  renderHome();
}

/* =======================
   HOME
======================= */

function renderHome() {
  document.getElementById('app').innerHTML = `
    <div class="card">
      <h2>Επιλογή Επιπέδου</h2>
      <div>
        <button class="btn-primary" onclick="start('level1')">Επίπεδο 1</button>
        <button class="btn-primary" onclick="start('level2')">Επίπεδο 2</button>
        <button class="btn-primary" onclick="start('level3')">Επίπεδο 3</button>
        <button class="btn-primary" onclick="start('level4')">Επίπεδο 4</button>
        <button class="btn-secondary" onclick="start('mixed')">Μικτό Επίπεδο</button>
      </div>

      <h2>Αριθμός Ασκήσεων</h2>
      <div>
        <button class="btn-secondary" onclick="setLimit(1)">1 (Παράδειγμα)</button>
        <button class="btn-secondary" onclick="setLimit(10)">10 (Εξάσκηση)</button>
        <button class="btn-secondary" onclick="setLimit('all')">ΟΛΕΣ (Επανάληψη)</button>
      </div>
    </div>
  `;
}

function setLimit(val) {
  questionLimit = val;
}

/* =======================
   START SESSION
======================= */

function start(level) {
  currentLevel = level;
  let filtered;

  if (level === 'mixed') {
    filtered = [...allData];
  } else {
    filtered = allData.filter(q => q.level === level);
  }

  if (questionLimit !== 'all') {
    filtered = filtered.slice(0, questionLimit);
  }

  sessionData = filtered;
  currentIndex = 0;
  renderQuestion();
}

/* =======================
   RENDER QUESTION
======================= */

function renderQuestion() {
  if (currentIndex >= sessionData.length) {
    renderEnd();
    return;
  }

  const q = sessionData[currentIndex];

  if (q.question_type === 'pick_words') {
    renderPickWords(q);
    return;
  }

  document.getElementById('app').innerHTML = `
    <div class="card">
      <div class="top-actions">
        <strong>Άσκηση ${currentIndex + 1}</strong>
        <button class="btn-danger" onclick="renderHome()">Αρχική</button>
      </div>
      <p>${q.question}</p>
      <button class="btn-primary" onclick="next()">Επόμενη</button>
    </div>
  `;
}

/* =======================
   PICK WORDS
======================= */

function renderPickWords(q) {
  const targets = q.targets.split('|').map(t => t.trim());
  let found = new Set();

  const words = q.text.split(' ').map(w =>
    `<span class="word" onclick="pick(this, '${w.replace(/[.,]/g,'')}')">${w}</span>`
  ).join(' ');

  document.getElementById('app').innerHTML = `
    <div class="card">
      <div class="top-actions">
        <strong>Επίπεδο 4</strong>
        <button class="btn-danger" onclick="renderHome()">Αρχική</button>
      </div>
      <p>${q.question}</p>
      <p>${words}</p>
    </div>
  `;

  window.pick = (el, word) => {
    if (targets.includes(word)) {
      el.classList.add('correct');
      found.add(word);
      if (found.size === targets.length) {
        setTimeout(next, 600);
      }
    } else {
      el.classList.add('wrong');
    }
  };
}

/* =======================
   NEXT / END
======================= */

function next() {
  currentIndex++;
  renderQuestion();
}

function renderEnd() {
  document.getElementById('app').innerHTML = `
    <div class="card">
      <h2>Τέλος Ασκήσεων</h2>
      <button class="btn-primary" onclick="renderHome()">Επιστροφή στην αρχική</button>
    </div>
  `;
}

loadCSV();
</script>
</body>
</html>
