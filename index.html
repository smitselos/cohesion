<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Συνοχή & Συνεκτικότητα</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:#f5f7fb;
    margin:0;
    padding:20px;
}
.card{
    max-width:900px;
    margin:0 auto 20px;
    background:#fff;
    border-radius:14px;
    padding:20px;
    box-shadow:0 4px 16px rgba(0,0,0,.08);
}
h1,h2{margin-top:0}
button{
    padding:12px 18px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-size:1rem;
}
.primary{background:#4f46e5;color:#fff}
.secondary{background:#64748b;color:#fff}
.choice{
    background:#eef2ff;
    border:2px solid #c7d2fe;
    margin:6px 0;
    width:100%;
    text-align:left;
}
.choice.correct{background:#16a34a;color:#fff}
.choice.wrong{background:#dc2626;color:#fff}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:10px;
}
.back{margin-top:20px}
</style>
</head>

<body>

<div id="app"></div>

<script>
/* ================= CSV ================= */
const CSV_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSBmZdhLakrSUcbxWqSdNo5O07jxI7YRJ_J890qyb-u0qqoOqe1RMl18UQx0SFbLBo2Ihdm6gOOnelY/pub?output=csv';

/* ================= STATE ================= */
let allData = [];
let questions = [];
let index = 0;
let selectedLevel = null;
let selectedCount = null;

/* ================= CSV PARSE ================= */
function parseCSV(text){
    const lines = text.trim().split('\n');
    const headers = lines.shift().split(',');
    return lines.map(line=>{
        const values = line.split(',');
        let obj = {};
        headers.forEach((h,i)=>obj[h]=values[i]||'');
        return obj;
    });
}

async function loadData(){
    const res = await fetch(CSV_URL);
    const txt = await res.text();
    allData = parseCSV(txt);
    renderHome();
}

/* ================= HOME ================= */
function renderHome(){
    selectedLevel = null;
    selectedCount = null;

    document.getElementById('app').innerHTML = `
    <div class="card">
        <h1>Συνοχή & Συνεκτικότητα</h1>

        <h2>Επιλογή Επιπέδου</h2>
        <div class="grid">
            <button class="primary" onclick="selectLevel(1)">Επίπεδο 1</button>
            <button class="primary" onclick="selectLevel(2)">Επίπεδο 2</button>
            <button class="primary" onclick="selectLevel(3)">Επίπεδο 3</button>
            <button class="primary" onclick="selectLevel(4)">Επίπεδο 4</button>
            <button class="secondary" onclick="selectLevel('mixed')">Μικτό</button>
        </div>

        <h2 style="margin-top:20px">Αριθμός Ασκήσεων</h2>
        <div class="grid">
            <button class="choice" onclick="selectCount(1)">1 (Παράδειγμα)</button>
            <button class="choice" onclick="selectCount(10)">10 (Εξάσκηση)</button>
            <button class="choice" onclick="selectCount('all')">Όλες (Επανάληψη)</button>
        </div>
    </div>
    `;
}

/* ================= SELECTION ================= */
function selectLevel(level){
    selectedLevel = level;
}

function selectCount(count){
    if(selectedLevel === null){
        alert('Διάλεξε πρώτα επίπεδο');
        return;
    }
    selectedCount = count;
    startQuiz();
}

/* ================= QUIZ ================= */
function startQuiz(){
    let pool = [...allData];

    if(selectedLevel !== 'mixed'){
        const map = {
            1:'multiple_choice',
            2:'fill_gap',
            3:'matching',
            4:'pick_words'
        };
        pool = pool.filter(q => q.question_type === map[selectedLevel]);
    }

    if(selectedCount !== 'all'){
        pool = pool.slice(0, selectedCount);
    }

    questions = pool;
    index = 0;

    if(questions.length === 0){
        alert('Δεν βρέθηκαν ασκήσεις για αυτή την επιλογή');
        return renderHome();
    }

    renderQuestion();
}

function renderQuestion(){
    const q = questions[index];

    let html = `
    <div class="card">
        <h2>Άσκηση ${index+1} / ${questions.length}</h2>
        <p><strong>${q.question}</strong></p>
        <p>${q.text}</p>
    `;

    if(q.question_type === 'multiple_choice'){
        html += `
        <button class="choice" onclick="check(this,'1')">${q.option1}</button>
        <button class="choice" onclick="check(this,'2')">${q.option2}</button>
        <button class="choice" onclick="check(this,'3')">${q.option3}</button>
        <button class="choice" onclick="check(this,'4')">${q.option4}</button>
        `;
    } else {
        html += `<p><em>(Ο τύπος άσκησης θα υλοποιηθεί στο επόμενο βήμα)</em></p>`;
    }

    html += `
        <div class="back">
            <button class="secondary" onclick="renderHome()">Επιστροφή στην αρχή</button>
        </div>
    </div>
    `;

    document.getElementById('app').innerHTML = html;
}

function check(btn,val){
    const q = questions[index];
    if(val == q.answer){
        btn.classList.add('correct');
    } else {
        btn.classList.add('wrong');
    }
    setTimeout(next,800);
}

function next(){
    index++;
    if(index < questions.length){
        renderQuestion();
    } else {
        alert('Τέλος ασκήσεων');
        renderHome();
    }
}

loadData();
</script>

</body>
</html>
